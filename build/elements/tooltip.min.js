import Text from'./text.min.js';import Floats from'../utils/float.min.js';import{UIBase,defineUIComponent,document,global}from'../utils/ui-component-base.min.js';import{mix}from'../../../mixwith/src/mixwith.js';const parentElements=new WeakMap,reflectedAttributes=['for','position','view-text'],template=document.createElement('template');template.innerHTML=`
  <style>
    :host {
      display: block;
      position: absolute;
      z-index: 0;
      background-color: #555;
      color: #fff;
      opacity: 0;
      transition: opacity;
      transition-duration: 300ms;
      max-width: 200px;
      max-height: 100px;
    }

    #tooltip {
      font-size: 10px;
      background-color: inherit;
      color: inherit;
      padding: 5px;
      border-radius: 2%;
      width: inherit;
      height: inherit;
    }

    :host(.faded-in) {
      opacity: 0.9;
      z-index: 2000;
    }
  </style>
  <div id="tooltip">
    <ui-text view-text="{{view-text}}"></ui-text>
  </div>
`;export const Tooltip=defineUIComponent({name:'ui-tooltip',template,reflectedAttributes,definition:class extends mix(UIBase).with(Floats){constructor(){super(),this._forHandlers=[]}init(){super.init(),this.floatingY=!0}_updatePosition(){let{top:a,left:b,height:c,width:d}=this.isFor.getBoundingClientRect();a+=global.scrollY||global.pageYOffset,b+=global.scrollX||global.pageXOffset;let{width:e,height:f}=this.getBoundingClientRect();switch(this.position){case'above':this.style.top=`${a-f-5}px`,this.style.left=`${b}px`;break;case'below':this.style.top=`${a+c+5}px`,this.style.left=`${b}px`;break;case'left':this.style.top=`${a}px`,this.style.left=`${b-e-5}px`;break;default:this.style.top=`${a}px`,this.style.left=`${b+d+5}px`;}return this}_attachForElementHandlers(){const[a,b]=this._forHandlers;return this.isFor.addEventListener('mouseenter',b),this.isFor.addEventListener('mouseleave',a),this}_removeForElementHandlers(){const[a,b]=this._forHandlers;return this.isFor.removeEventListener('mouseenter',b),this.isFor.removeEventListener('mouseleave',a),this}show(){return this.viewText&&(this._updatePosition(),this.classList.add('faded-in')),this}hide(){return this.classList.remove('faded-in'),this}get isFor(){return parentElements.get(this)}set isFor(a){return parentElements.set(this,a),this._attachForElementHandlers()}connectedCallback(){super.connectedCallback(),this._forHandlers.length||this._forHandlers.push(()=>this.hide(),()=>this.show());let a=((a)=>{for(;a=a.parentNode;){if(a.host)return a.host;if(a===document)return a}})(this);if(this.for&&(this.isFor=a.querySelector(`#${this.for}`)),this.isFor||(this.isFor=this.parentNode.host||this.parentNode),!this.isFor)throw new Error('ui-tooltip must have a "for" attribute/property or a parent');this._attachForElementHandlers(),this.textContent&&!this.attr('view-text')&&this.attr('view-text',this.textContent)}disconnectedCallback(){super.disconnectedCallback(),this._removeForElementHandlers()}}});export const TooltipMixin=(a)=>defineUIComponent({name:'ui-has-tooltip',registerElement:!1,reflectedAttributes:['tooltip'],definition:class extends a{constructor(){super(),this._tooltipElement=document.createElement('ui-tooltip'),this._tooltipElement.isFor=this}init(){super.init(),this.tooltip&&(this._tooltipElement.viewText=this.tooltip,document.body.insertBefore(this._tooltipElement,document.body.firstElementChild)),this.watchAttribute(this,'tooltip',(a)=>{let b=document.body.contains(this._tooltipElement);a&&!b&&document.body.appendChild(this._tooltipElement),!a&&b&&document.body.removeChild(this._tooltipElement),this._tooltipElement.viewText=a})}disconnectedCallback(){super.disconnectedCallback(),document.body.removeChild(this._tooltipElement)}connectedCallback(){super.connectedCallback(),this._tooltipElement&&document.body.insertBefore(this._tooltipElement,document.body.firstElementChild)}}});