#!/usr/bin/env node
'use strict';const express=require('express'),fs=require('fs'),upload=require('multer')(),app=express(),workingDirectory=process.cwd(),serverDirectory=__dirname;app.use(express.static(`${workingDirectory}/src`));const toObjectString=(a,b=0)=>{if(3<b)return'\n';let c=[];for(var d in a)if(!d.match(/^\_/)){let e=a[d];switch(typeof e){case'function':c.push(`${d}: function,`);break;case'object':if(e){c.push(`${d}:\n${toObjectString(e,b+1)}`);break}default:c.push(`${'\t'.repeat(b)}${d}: ${''+e}`);}}return c.join('\n')};app.post('/data/login',function(a,b){b.end(JSON.stringify(!0))}),app.post('/data/formtest',upload.array(),function(a,b){Object.entries(a.body).toString()===Object.entries({foo:3}).toString()?b.end('foo'):b.end('bar')}),app.post('/data/formtest2',upload.array(),function(a,b){Object.entries(a.body).toString()===Object.entries({foo:3}).toString()?b.end('extra'):b.end('sauce')}),app.get('*',function(a,b,c){if(console.log(`URL: ${a.url}`),a.path.match(/\.[0-9a-zA-Z]*$/)){console.log(`File ${a.path} requested, serving...`);let c=['mixwith','jsstring','extracttype'].find((b)=>a.url.match(b)),d=c?`${workingDirectory}/node_modules/${a.path}`:`${workingDirectory}/${a.path}`;return b.sendFile(d),void console.log('done.')}c()},function(a,b,c){console.log(`path is ${a.path}`);let d=a.path.match(/\/$/)?a.url:`${a.url}/`,e=a.path.split('/').filter((a)=>a);try{console.log('Checking directory for index.html...');const c=a.url.match(/\/$/)?a.url:`${a.url}/`;return b.sendFile(`${workingDirectory}/${c}index.html`),void console.log('done.')}catch(a){console.log('not found.'),c()}},function(a,b){return console.log('Serving local index.html...'),b.sendFile(`${workingDirectory}/index.html`),void console.log('done.')}),app.listen(8080,()=>console.log(`ui-components dev server listening at localhost:8080.`));